{"version":3,"sources":["./src/assets/dist/esm/legacy/kup-chart.entry.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkG;AACrE;AACuF;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,8BAA8B;AAC/B;AACA;AACA;AACA;AACA,CAAC,kCAAkC;AACnC;AACA;AACA,eAAe,4DAAO;AACtB;AACA,WAAW,4DAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAM;AACrB;AACA,WAAW,4DAAM;AACjB;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,4DAAQ;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,4DAAM;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,QAAQ,4DAAgB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,4DAAW;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,0DAA0D,EAAE;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,uBAAuB,yBAAyB;AAChD;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,4DAAiB;AACpD;AACA;AACA,mCAAmC,4DAAiB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,4DAAC,SAAS,kCAAkC,oCAAoC,EAAE,EAAE;AACnG;AACA;AACA,0BAA0B,QAAQ,4DAAU,OAAO,EAAE;AACrD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA,CAAC;AACgC","file":"5-es2015.js","sourcesContent":["import { r as registerInstance, c as createEvent, h, g as getElement } from './chunk-1851c479.js';\nimport './chunk-d8060b98.js';\nimport { n as numeral, m as moment, i as isNumber, a as isDate, g as getColumnByName$1 } from './chunk-621f9806.js';\nvar ChartType;\n(function (ChartType) {\n    ChartType[\"Area\"] = \"Area\";\n    ChartType[\"Bubble\"] = \"Bubble\";\n    ChartType[\"Cal\"] = \"Cal\";\n    ChartType[\"Candlestick\"] = \"Candlestick\";\n    ChartType[\"Combo\"] = \"Combo\";\n    ChartType[\"Geo\"] = \"Geo\";\n    ChartType[\"Hbar\"] = \"Hbar\";\n    ChartType[\"Line\"] = \"Line\";\n    ChartType[\"Ohlc\"] = \"Ohlc\";\n    ChartType[\"Pie\"] = \"Pie\";\n    ChartType[\"Sankey\"] = \"Sankey\";\n    ChartType[\"Scatter\"] = \"Scatter\";\n    ChartType[\"Unk\"] = \"Unk\";\n    ChartType[\"Vbar\"] = \"Vbar\";\n})(ChartType || (ChartType = {}));\nvar ChartAspect;\n(function (ChartAspect) {\n    ChartAspect[\"D2\"] = \"2D\";\n    ChartAspect[\"D3\"] = \"3D\";\n})(ChartAspect || (ChartAspect = {}));\nfunction formatToNumber(cell) {\n    if (cell.obj) {\n        return numeral(cell.obj.k).value();\n    }\n    return numeral(cell.value).value();\n}\nfunction formatToMomentDate(cell) {\n    var format = 'YYYYMMDD';\n    if (cell.obj) {\n        var obj = cell.obj;\n        if ('D8' === obj.t && '*DMYY' === obj.p) {\n            format = 'DDMMYYYY';\n        }\n        return moment(cell.obj.k, format);\n    }\n    return moment(cell.value, 'DD/MM/YYYY');\n}\n// TODO this should be in a \"data-table\" utility file\nfunction getColumnByName(name, columns) {\n    for (var i = 0; i < columns.length; i++) {\n        var column = columns[i];\n        if (name === column.name) {\n            return column;\n        }\n    }\n    return null;\n}\nvar convertColumns = function (data, _a) {\n    var series = _a.series, axis = _a.axis;\n    if (!data || !series) {\n        return [];\n    }\n    var columns = [];\n    // axis\n    var axisColumn = getColumnByName(axis, data.columns);\n    if (axisColumn) {\n        columns.push(axisColumn);\n    }\n    // series\n    series.map(function (serie) {\n        // searching colum\n        var c = getColumnByName(serie, data.columns);\n        if (c) {\n            columns.push(c);\n        }\n    });\n    return columns;\n};\nvar convertRows = function (data, columns, showMarks) {\n    if (!data) {\n        return [];\n    }\n    var rows = [];\n    if (data.rows) {\n        data.rows.forEach(function (r) {\n            var cells = r.cells;\n            var currentRow = [];\n            columns.forEach(function (c, index) {\n                var cell = cells[c.name];\n                if (cell && cell.obj) {\n                    var addMark = showMarks && index > 0;\n                    if (isNumber(cell.obj)) {\n                        var value = formatToNumber(cell);\n                        currentRow.push(value);\n                        if (addMark) {\n                            currentRow.push(value.toString());\n                        }\n                    }\n                    else if (isDate(cell.obj)) {\n                        var value = formatToMomentDate(cell).toDate();\n                        currentRow.push(value);\n                        if (addMark) {\n                            currentRow.push(value.toString());\n                        }\n                    }\n                    else {\n                        currentRow.push(cell.obj.k);\n                        if (addMark) {\n                            currentRow.push(cell.value);\n                        }\n                    }\n                }\n            });\n            rows.push(currentRow);\n        });\n    }\n    return rows;\n};\nvar KupChart = /** @class */ (function () {\n    function KupChart(hostRef) {\n        registerInstance(this, hostRef);\n        this.types = [ChartType.Hbar];\n        this.colors = [];\n        this.legend = true;\n        this.stacked = false;\n        this.showMarks = false;\n        /**\n         * Google chart version to load\n         */\n        this.version = '45.2';\n        this.kupChartClicked = createEvent(this, \"kupChartClicked\", 6);\n    }\n    KupChart.prototype.onDataChanged = function () {\n        console.log('changing data');\n    };\n    KupChart.prototype.componentDidLoad = function () {\n        var _this = this;\n        if (!this.axis || !this.series) {\n            // cannot create chart\n            return;\n        }\n        // loading charts\n        if (google) {\n            // getting google charts css from main document\n            document\n                .querySelectorAll(\"link[href^=\\\"https://www.gstatic.com/charts/\" + this.version + \"/css\\\"]\")\n                .forEach(function (node) { return _this.el.shadowRoot.appendChild(node.cloneNode()); });\n            try {\n                this.loadGoogleChart();\n            }\n            catch (err) {\n                console.error(err);\n            }\n        }\n    };\n    KupChart.prototype.componentWillUpdate = function () {\n        if (this.gChart) {\n            this.gChart.clearChart();\n        }\n    };\n    KupChart.prototype.componentDidUpdate = function () {\n        this.loadGoogleChart();\n    };\n    KupChart.prototype.loadGoogleChart = function () {\n        google.charts.setOnLoadCallback(this.createChart.bind(this));\n    };\n    KupChart.prototype.createGoogleChart = function () {\n        if (this.isComboChart()) {\n            return new google.visualization.ComboChart(this.chartContainer);\n        }\n        else if (this.types.length === 1) {\n            switch (this.types[0]) {\n                case ChartType.Area:\n                    return new google.visualization.AreaChart(this.chartContainer);\n                case ChartType.Bubble:\n                    return new google.visualization.BubbleChart(this.chartContainer);\n                case ChartType.Cal:\n                    return new google.visualization.Calendar(this.chartContainer);\n                case ChartType.Candlestick:\n                    return new google.visualization.CandlestickChart(this.chartContainer);\n                case ChartType.Geo:\n                    return new google.visualization.GeoChart(this.chartContainer);\n                case ChartType.Hbar:\n                    return new google.visualization.BarChart(this.chartContainer);\n                case ChartType.Line:\n                    return new google.visualization.LineChart(this.chartContainer);\n                case ChartType.Pie:\n                    return new google.visualization.PieChart(this.chartContainer);\n                case ChartType.Sankey:\n                    return new google.visualization.Sankey(this.chartContainer);\n                case ChartType.Scatter:\n                    return new google.visualization.ScatterChart(this.chartContainer);\n                default:\n                    return new google.visualization.ColumnChart(this.chartContainer);\n            }\n        }\n    };\n    KupChart.prototype.getMainChartType = function () {\n        if (this.types.length > 0) {\n            return this.types[0];\n        }\n        return ChartType.Unk;\n    };\n    KupChart.prototype.isComboChart = function () {\n        return this.types.length > 1;\n    };\n    KupChart.prototype.createGoogleChartOptions = function () {\n        var opts = {\n            is3D: ChartAspect.D3 === this.asp,\n        };\n        if (this.colors && this.colors.length > 0) {\n            opts.colors = this.colors;\n        }\n        if (this.width) {\n            opts.width = this.width;\n        }\n        if (this.height) {\n            opts.height = this.height;\n        }\n        if (!this.legend) {\n            opts.legend = {\n                position: 'none',\n            };\n        }\n        if (this.stacked &&\n            (ChartType.Hbar === this.getMainChartType() ||\n                ChartType.Vbar === this.getMainChartType())) {\n            opts.isStacked = true;\n        }\n        if (this.graphTitle) {\n            opts.title = this.graphTitle;\n            opts.titleTextStyle = {};\n            if (this.graphTitleColor) {\n                opts.titleTextStyle.color = this.graphTitleColor;\n            }\n            if (this.graphTitleSize) {\n                opts.titleTextStyle.fontSize = this.graphTitleSize;\n            }\n        }\n        // series for combo chart\n        if (this.isComboChart()) {\n            opts.series = {};\n            this.types.forEach(function (type, index) {\n                var serieType = 'bars';\n                if (ChartType.Line === type) {\n                    serieType = 'line';\n                }\n                else if (ChartType.Area === type) {\n                    serieType = 'area';\n                }\n                opts.series[index.toString()] = {\n                    type: serieType,\n                };\n            });\n        }\n        return opts;\n    };\n    KupChart.prototype.createChart = function () {\n        var tableColumns = convertColumns(this.data, {\n            axis: this.axis,\n            series: this.series,\n        });\n        var tableRows = convertRows(this.data, tableColumns, this.showMarks);\n        var dataTableColumns = [];\n        for (var i = 0; i < tableColumns.length; i++) {\n            var c = tableColumns[i];\n            dataTableColumns.push({\n                label: c.name,\n            });\n            if (i > 0 && this.showMarks) {\n                dataTableColumns.push({\n                    type: 'string',\n                    role: 'annotation',\n                });\n            }\n        }\n        this.gChartDataTable = new google.visualization.arrayToDataTable([\n            dataTableColumns\n        ].concat(tableRows));\n        this.gChartView = new google.visualization.DataView(this.gChartDataTable);\n        this.gChart = this.createGoogleChart();\n        var options = this.createGoogleChartOptions();\n        this.gChart.draw(this.gChartView, options);\n        google.visualization.events.addListener(this.gChart, 'select', this.onChartSelect.bind(this));\n    };\n    KupChart.prototype.onChartSelect = function () {\n        var selectedItem = this.gChart.getSelection()[0];\n        if (selectedItem) {\n            var event = {};\n            if (selectedItem.date) {\n                // calendar chart\n                event.datetime = selectedItem.date;\n                if (selectedItem.row || selectedItem.row == 0) {\n                    var rowIndex = this.gChartView.getTableRowIndex(selectedItem.row);\n                    event.row = this.data.rows[rowIndex];\n                }\n                else {\n                    return;\n                }\n            }\n            else {\n                // any other chart\n                var rowIndex = selectedItem.row;\n                var colIndex = selectedItem.column;\n                var originalRowIndex = this.gChartView.getTableRowIndex(rowIndex != null ? rowIndex : 0);\n                event.row = this.data.rows[originalRowIndex];\n                if (this.series.length > 1) {\n                    var originalColIndex = this.gChartView.getTableColumnIndex(colIndex != null ? colIndex : 0);\n                    // checking if col is annotation\n                    if ('annotation' ===\n                        this.gChartDataTable.getColumnProperty(originalColIndex, 'role')) {\n                        --originalColIndex;\n                    }\n                    event.column = getColumnByName$1(this.data.columns, this.series[originalColIndex - 1]);\n                }\n                else {\n                    event.column = getColumnByName$1(this.data.columns, this.series[0]);\n                }\n            }\n            this.kupChartClicked.emit(event);\n        }\n    };\n    KupChart.prototype.render = function () {\n        var _this = this;\n        return h(\"div\", { id: \"chart\", ref: function (el) { return (_this.chartContainer = el); } });\n    };\n    Object.defineProperty(KupChart.prototype, \"el\", {\n        get: function () { return getElement(this); },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(KupChart, \"watchers\", {\n        get: function () {\n            return {\n                \"data\": [\"onDataChanged\"]\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return KupChart;\n}());\nexport { KupChart as kup_chart };\n"],"sourceRoot":"webpack:///"}